/**
 * almond 0.2.6 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(t,n){"function"==typeof define&&define.amd?define(n):(t.libGlobalName=n(),window.coffeequate=window.CQ=n())}(this,function(){var t,n,e;return function(r){function i(t,n){return v.call(t,n)}function o(t,n){var e,r,i,o,l,u,s,a,p,h,c=n&&n.split("/"),f=b.map,d=f&&f["*"]||{};if(t&&"."===t.charAt(0))if(n){for(c=c.slice(0,c.length-1),t=c.concat(t.split("/")),a=0;a<t.length;a+=1)if(h=t[a],"."===h)t.splice(a,1),a-=1;else if(".."===h){if(1===a&&(".."===t[2]||".."===t[0]))break;a>0&&(t.splice(a-1,2),a-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((c||d)&&f){for(e=t.split("/"),a=e.length;a>0;a-=1){if(r=e.slice(0,a).join("/"),c)for(p=c.length;p>0;p-=1)if(i=f[c.slice(0,p).join("/")],i&&(i=i[r])){o=i,l=a;break}if(o)break;!u&&d&&d[r]&&(u=d[r],s=a)}!o&&u&&(o=u,l=s),o&&(e.splice(0,l,o),t=e.join("/"))}return t}function l(t,n){return function(){return f.apply(r,x.call(arguments,0).concat([t,n]))}}function u(t){return function(n){return o(n,t)}}function s(t){return function(n){g[t]=n}}function a(t){if(i(w,t)){var n=w[t];delete w[t],m[t]=!0,c.apply(r,n)}if(!i(g,t)&&!i(m,t))throw new Error("No "+t);return g[t]}function p(t){var n,e=t?t.indexOf("!"):-1;return e>-1&&(n=t.substring(0,e),t=t.substring(e+1,t.length)),[n,t]}function h(t){return function(){return b&&b.config&&b.config[t]||{}}}var c,f,d,y,g={},w={},b={},m={},v=Object.prototype.hasOwnProperty,x=[].slice;d=function(t,n){var e,r=p(t),i=r[0];return t=r[1],i&&(i=o(i,n),e=a(i)),i?t=e&&e.normalize?e.normalize(t,u(n)):o(t,n):(t=o(t,n),r=p(t),i=r[0],t=r[1],i&&(e=a(i))),{f:i?i+"!"+t:t,n:t,pr:i,p:e}},y={require:function(t){return l(t)},exports:function(t){var n=g[t];return"undefined"!=typeof n?n:g[t]={}},module:function(t){return{id:t,uri:"",exports:g[t],config:h(t)}}},c=function(t,n,e,o){var u,p,h,c,f,b,v=[];if(o=o||t,"function"==typeof e){for(n=!n.length&&e.length?["require","exports","module"]:n,f=0;f<n.length;f+=1)if(c=d(n[f],o),p=c.f,"require"===p)v[f]=y.require(t);else if("exports"===p)v[f]=y.exports(t),b=!0;else if("module"===p)u=v[f]=y.module(t);else if(i(g,p)||i(w,p)||i(m,p))v[f]=a(p);else{if(!c.p)throw new Error(t+" missing "+p);c.p.load(c.n,l(o,!0),s(p),{}),v[f]=g[p]}h=e.apply(g[t],v),t&&(u&&u.exports!==r&&u.exports!==g[t]?g[t]=u.exports:h===r&&b||(g[t]=h))}else t&&(g[t]=e)},t=n=f=function(t,n,e,i,o){return"string"==typeof t?y[t]?y[t](n):a(d(t,n).f):(t.splice||(b=t,n.splice?(t=n,n=e,e=null):t=r),n=n||function(){},"function"==typeof e&&(e=i,i=o),i?c(r,t,n,e):setTimeout(function(){c(r,t,n,e)},4),f)},f.config=function(t){return b=t,b.deps&&f(b.deps,b.callback),f},t._defined=g,e=function(t,n,e){n.splice||(e=n,n=[]),i(g,t)||i(w,t)||(w[t]=[t,n,e])},e.amd={jQuery:!0}}(),e("lib/almond",function(){}),function(){e("generateInfo",[],function(){return{getMathMLInfo:function(t,n,e){var r,i,o,l;return null==e&&(e="0"),i=n?"expression":"equation",o=""+i+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),l=null!=t?'id="'+o+'"':"",r="<div "+l+' class="'+i+'"><math xmlns="http://www.w3.org/1998/Math/MathML">'+(null!=e?(isFinite(e)?"<mn>"+e+"</mn>":null!=e.toMathML?""+e.toMathML(t,n):"<mi>"+e+"</mi>")+"<mo>=</mo>":""),[i,o,r]},getHTMLInfo:function(t,n,e){var r,i,o,l;return null==e&&(e="0"),i=n?"expression":"equation",o=""+i+"-"+(null!=t?t:Math.floor(1e7*Math.random()).toString(16)),l=null!=t?'id="'+o+'"':"",r="<div "+l+' class="'+i+'">'+(null!=e?(null!=e.toHTML?""+e.toHTML(t,n):""+e)+"=":""),[i,o,r]}}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};e("nodes",["generateInfo"],function(){var t;return t=function(){function t(t){this.label=t}return t.prototype.getChildren=function(){return[]},t.prototype.getAllVariables=function(){return[]},t.prototype.toDrawingNode=function(){throw new Error("toDrawingNode not implemented for "+self.toString())},t.prototype.toLaTeX=function(){return this.toDrawingNode().renderLaTeX()},t.prototype.toString=function(){return this.toDrawingNode().renderString()},t.prototype.toMathML=function(){return this.toDrawingNode().renderMathML()},t.prototype.stringEqual=function(t){return t.toString()===this.toString()},t}(),{BasicNode:t,RoseNode:function(t){function e(t,n){this.children=null!=n?n:null,null==this.children&&(this.children=[]),e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.getChildren=function(){return this.children},e.prototype.toLisp=function(){var t;return t=this.children.map(function(t){return t.toLisp?t.toLisp():t}),"("+this.label+(this.children?" ":"")+t.join(" ")+")"},e}(t),BinaryNode:function(t){function e(t,n,e){this.label=t,this.children={left:n,right:e}}return n(e,t),e.prototype.getChildren=function(){return[this.children.left,this.children.right]},e.prototype.toLisp=function(){var t;return t=function(t){return t.toLisp?t.toLisp():t},"("+this.label+" "+t(this.children.left)+" "+t(this.children.right)+")"},e}(t)}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};e("parse",["require"],function(t){var e,r,i,o,l,u,s,a;return i=function(t){function e(t,n){this.input=t,this.type=n}return n(e,t),e.prototype.toString=function(){return"Could not parse '"+this.input+"' as "+this.type},e}(Error),s=/^@*[a-zA-Z\u0391-\u03A9\u03B1-\u03C9][a-zA-Z\u0391-\u03A9\u03B1-\u03C9_\-\d]*$/,e=/^-?\d+(\.\d+)?$/,o=/^-?\d+(\.\d+)?\/\d+(\.\d+)?$/,l=/^\\@*[a-zA-Z\u0391-\u03A9\u03B1-\u03C9][a-zA-Z\u0391-\u03A9\u03B1-\u03C9_\-\d]*$/,r=/^[^:]*::\{[^:+]*\}$/,a=function(n){var p,h,c;if(/\^/.test(n))throw new Error("Unexpected carat (^). Coffeequate uses ** for exponentiation");if(r.test(n))return p=n.split("::"),h=a(p[0]),h.units=new u(p[1].slice(1,p[1].length-1)),h;if(n=n.trim(),c=t("terminals"),e.test(n)||o.test(n))return new c.Constant(n);if(s.test(n))return"σ"===n[0]?new c.Uncertainty(n.slice(1)):new c.Variable(n);if(l.test(n))return new c.SymbolicConstant(n.slice(1));throw new i(n,"terminal")},u=function(){function n(e,r){var i;return null==r&&(r=!0),this.tokens=n.tokenise(e).reverse(),this.upto=0,this.operators=t("operators"),i=this.parseAddition(),r&&(i=i.expandAndSimplify()),i}return n.tokenise=function(t){return t.split(/(\*\*|[+*()\-:]|\s)/).filter(function(t){return!/^\s*$/.test(t)})},n.prototype.getToken=function(){return this.tokens[this.upto]},n.prototype.parseAddition=function(){var t,n;return n=this.parseMultiplication(),"+"!==this.getToken()?n:(this.upto+=1,t=this.parseAddition(),new this.operators.Add(t,n))},n.prototype.parseMultiplication=function(){var t,n;if(n=this.parsePower(),this.getToken()&&s.test(this.getToken()))throw new i(this.getToken(),"multiplication");return"*"!==this.getToken()?n:(this.upto+=1,t=this.parseMultiplication(),new this.operators.Mul(t,n))},n.prototype.parsePower=function(){var t,n;return t=this.parseBracket(),"**"!==this.getToken()?t:(this.upto+=1,n=this.parsePower(),new this.operators.Pow(n,t))},n.prototype.parseBracket=function(){var t,n;if(")"===this.getToken()){if(this.upto+=1,t=this.parseAddition(),"("!==this.getToken())throw new Error("ParseError: Expected '(' but found '"+this.getToken()+"' at position "+(""+(this.tokens.length-this.upto)+"/"+this.tokens.length+" in token stream '"+this.tokens.reverse().join(" ")+"'"));return this.upto+=1,"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,t)):t}return n=this.parseTerm(),"-"===this.getToken()?(this.upto+=1,new this.operators.Mul(-1,n)):n},n.prototype.parseTerm=function(){var t,n;if(n=[],"}"===this.getToken()[this.getToken().length-1]){for(;":"!==this.getToken()[0];)n.push(this.getToken()),this.upto+=1;n.push(this.getToken()),this.upto+=1,n.push(this.getToken()),this.upto+=1,n.push(this.getToken()),t=a(n.reverse().join(""))}else t=a(this.getToken());return this.upto+=1,t},n}(),{ParseError:i,stringToExpression:function(t,n){return null==n&&(n=!0),new u(t,n)},constant:function(t){if("string"==typeof t||t instanceof String){if(""===t)throw new i("","constant");if(t=t.split("/"),1===t.length)return[parseFloat(t[0]),1];if(2===t.length)return[parseFloat(t[0]),parseFloat(t[1])];throw new i(t.join("/"),"constant")}if("number"==typeof t||t instanceof Number)return[t,1];throw new i(t,"constant")},stringToTerminal:a}})}.call(this),function(){var t=[].slice,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};e("prettyRender",[],function(){var n,e,i,o,l,u,s,a,p,h;return i=function(){function t(){}return t.prototype.toString=function(){throw new Error("not implemented")},t.prototype.renderLaTeX=function(){throw new Error("not implemented")},t.prototype.bindingStrength=function(){return 8},t.prototype.bracketIfNeeded=function(t){return t.bindingStrength<=this.bindingStrength()?new e(t):t},t}(),i.makeWithBrackets=function(){var n,r;return r=1<=arguments.length?t.call(arguments,0):[],n=new this,r=r.map(function(t){return t.bindingStrength<=n.bindingStrength()?new e(t):t}),n.terms=r,n},n=function(n){function e(){var n;n=1<=arguments.length?t.call(arguments,0):[],this.terms=n}return r(e,n),e.prototype.bindingStrength=function(){return 4},e.prototype.renderLaTeX=function(){return this.terms.map(function(t){return t.renderLaTeX()}).join(" + ")},e.prototype.renderString=function(){return this.terms.map(function(t){return t.renderString()}).join(" + ")},e.prototype.renderMathML=function(){return this.terms.map(function(t){return t.renderMathML()}).join("<mo>+</mo>")},e}(i),l=function(n){function e(){var n;n=1<=arguments.length?t.call(arguments,0):[],this.terms=n}return r(e,n),e.prototype.bindingStrength=function(){return 6},e.prototype.renderLaTeX=function(){return this.terms.map(function(t){return t.renderLaTeX()}).join(" \\cdot ")},e.prototype.renderString=function(){return this.terms.map(function(t){return t.renderString()}).join("*")},e.prototype.renderMathML=function(){return this.terms.map(function(t){return t.renderMathML()}).join("<mo>&middot;</mo>")},e}(i),s=function(t){function n(t,n){this.left=t,this.right=n}return r(n,t),n.prototype.renderLaTeX=function(){return""+this.left.renderLaTeX()+"^{"+this.right.renderLaTeX()+"}"},n.prototype.renderString=function(){return""+this.left.renderString()+"**"+this.bracketIfNeeded(this.right).renderString()},n.prototype.renderMathML=function(){return"<msup>"+this.left.renderMathML()+this.right.renderMathML()+"</msup>"},n}(i),e=function(t){function n(t){this.contents=t}return r(n,t),n.prototype.bindingStrength=function(){return 9},n.prototype.renderLaTeX=function(){return"\\left("+this.contents.renderLaTeX()+"\\right)"},n.prototype.renderString=function(){return"("+this.contents.renderString()+")"},n.prototype.renderMathML=function(){return"<mfenced><mrow>"+this.contents.renderMathML()+"</mrow></mfenced>"},n}(i),u=function(t){function n(t){this.value=t}return r(n,t),n.prototype.bindingStrength=function(){return 10},n.prototype.renderLaTeX=function(){return this.value+""},n.prototype.renderString=function(){return this.value+""},n.prototype.renderMathML=function(){return'<mn class="constant">'+this.value+"</mn>"},n}(i),h=function(t){function n(t,n){this.label=t,this.classname=null!=n?n:"variable"}return r(n,t),n.prototype.bindingStrength=function(){return 10},n.prototype.renderLaTeX=function(){return this.label},n.prototype.renderString=function(){return this.label},n.prototype.renderMathML=function(){var t,n,e,r,i,o;for(o=this.label.split("-"),i=o[0],t=0;"@"===i[0];)t+=1,i=i.slice(1);return e='<mover accent="true">',n="<mrow><mo>"+function(){var n,e;for(e=[],r=n=0;t>=0?t>n:n>t;r=t>=0?++n:--n)e.push(".");return e}().join("")+"</mo></mrow></mover>",i.length>1?e+'<msub class="'+this.classname+'"><mi>'+i[0]+"</mi><mi>"+i.slice(1)+"</mi></msub>"+n:'<mi class="'+this.classname+'">'+i+"</mi>"},n}(i),o=function(t){function n(t,n){this.top=t,this.bottom=n}return r(n,t),n.prototype.bindingStrength=function(){return 8},n.prototype.renderLaTeX=function(){return"\\frac{"+this.top.renderLaTeX()+"}{"+this.bottom.renderLaTeX()+"}"},n.prototype.renderString=function(){return""+this.bracketIfNeeded(this.top).renderString()+"/"+this.bracketIfNeeded(this.bottom).renderString()},n.prototype.renderMathML=function(t,n){return"<mfrac> <mrow>"+this.top.renderMathML(t,n)+"</mrow> <mrow>"+this.bottom.renderMathML(t,n)+"</mrow> </mfrac>"},n}(i),a=function(n){function e(t,n){this.contents=t,this.power=null!=n?n:null}return r(e,n),e.prototype.renderLaTeX=function(){return this.power&&2!==this.power?"\\sqrt["+this.power+"]{"+this.contents.renderLaTeX()+"}":"\\sqrt{"+this.contents.renderLaTeX()+"}"},e.prototype.renderString=function(){return this.power&&2!==this.power?""+this.bracketIfNeeded(this.contents).renderString()+" ** "+this.power+"}":"sqrt("+this.contents.renderString()+")"},e.prototype.renderMathML=function(){var n,e,r,i;return n=1<=arguments.length?t.call(arguments,0):[],this.power&&2!==this.power?"<mroot> <mrow> "+(e=this.power).renderMathML.apply(e,n)+" </mrow> <mrow> "+(r=this.contents).renderMathML.apply(r,n)+" </mrow> </mroot>":"<msqrt> "+(i=this.contents).renderMathML.apply(i,n)+" </msqrt>"},e}(i),p=function(n){function e(t,n){this.label=t,this["class"]=null!=n?n:"default"}return r(e,n),e.prototype.bindingStrength=function(){return 9},e.prototype.renderLaTeX=function(){return"\\sigma_{"+this.label+"}"},e.prototype.renderString=function(){return"σ("+this.label+")"},e.prototype.renderMathML=function(){var n,e;return e=1<=arguments.length?t.call(arguments,0):[],n=new h(this.label),"<msub><mo>&sigma;</mo>"+n.renderMathML.apply(n,e)+"</msub>"},e}(i),{DrawingNode:i,Add:n,Mul:l,Pow:s,Bracket:e,Number:u,Variable:h,Fraction:o,Surd:a,Uncertainty:p}})}.call(this),function(){e("constants",[],function(){return{c:299792458,G:6.67384e-11,π:Math.PI,PI:Math.PI,E:Math.E,e:Math.E,ε0:8.85418782e-12,μ0:125663706e-14,k:1.3806488e-23,h:6.62606957e-34,hbar:1.05457173e-34,NA:6.02214129e23,mu:1.66053892e-27,a0:5.29e-11,ke:1/(8.85418782e-12*4*Math.PI),ec:1.60217657e-19,R:8.3144621}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("terminals",["parse","generateInfo","nodes","prettyRender","constants"],function(t,e,i,o,l){var u,s,a,p,h;return a=function(t){function e(t){this.label=t}return n(e,t),e.prototype.evaluate=function(){},e.prototype.copy=function(){return new e(this.label)},e}(i.BasicNode),u=function(e){function r(n,e){var r,i;this.denominator=null!=e?e:null,this.cmp=-6,null!=this.denominator?(r=t.constant(n),this.numerator=r[0],e=r[1],this.denominator*=e):(i=t.constant(n),this.numerator=i[0],this.denominator=i[1]),this.denominator<0&&(this.denominator*=-1,this.numerator*=-1),this.numerator=parseFloat(this.numerator.toPrecision(6))}return n(r,e),r.prototype.evaluate=function(){return parseFloat((this.numerator/this.denominator).toPrecision(6))},r.prototype.copy=function(){return new r(this.numerator,this.denominator)},r.prototype.compareSameType=function(t){return this.evaluate()<t.evaluate()?-1:this.evaluate()===t.evaluate()?0:1},r.prototype.multiply=function(t){return new r(this.numerator*t.numerator,this.denominator*t.denominator)},r.prototype.add=function(t){return new r(t.denominator*this.numerator+this.denominator*t.numerator,this.denominator*t.denominator)},r.prototype.equals=function(t){return t instanceof r?this.evaluate()===t.evaluate():!1},r.prototype.replaceVariables=function(){return this.copy()},r.prototype.getAllVariables=function(){return[]},r.prototype.sub=function(){return this.copy()},r.prototype.simplifyInPlace=function(){var t,n,e,r;for(t=this.numerator,n=this.denominator;0!==n;)r=[n,Math.round(10*(t%n))/10],t=r[0],n=r[1];return e=t,this.numerator/=e,this.numerator=Math.round(10*this.numerator)/10,this.denominator/=e,this.denominator=Math.round(10*this.denominator)/10},r.prototype.simplify=function(){var t;return t=this.copy()},r.prototype.expand=function(){return this.copy()},r.prototype.expandAndSimplify=function(){return this.simplify()},r.prototype.substituteExpression=function(){return[this.copy()]},r.prototype.getUncertainty=function(){return new r(0)},r.prototype.getVariableUnits=function(){return null},r.prototype.setVariableUnits=function(){return null},r.prototype.toDrawingNode=function(){var t,n;return n=o.Number,t=o.Fraction,1===this.denominator?new n(this.numerator):new t(new n(this.numerator),new n(this.denominator))},r.prototype.differentiate=function(){return new r(0)},r}(a),s=function(t){function e(t,n,e){this.label=t,this.value=null!=n?n:null,this.units=null!=e?e:null,this.cmp=-5}return n(e,t),e.prototype.copy=function(){return new e(this.label,this.value,this.units)},e.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},e.prototype.evaluate=function(){return this.value},e.prototype.equals=function(t){return t instanceof e?this.label===t.label&&this.value===t.value:!1},e.prototype.replaceVariables=function(){return this.copy()},e.prototype.getAllVariables=function(){return[]},e.prototype.sub=function(t,n,e,r,i){return null==e&&(e=null),null==r&&(r=!1),null==i&&(i=!1),i?this.label in l?new u(l[this.label]):void 0:this.copy()},e.prototype.simplify=function(){return this.copy()},e.prototype.expand=function(){return this.copy()},e.prototype.expandAndSimplify=function(){return this.copy()},e.prototype.substituteExpression=function(){return[this.copy()]},e.prototype.getUncertainty=function(){return new u(0)},e.prototype.getVariableUnits=function(){return null},e.prototype.setVariableUnits=function(){return null},e.prototype.toDrawingNode=function(){var t;return t=o.Variable,new t(this.label,"constant symbolic-constant")},e.prototype.differentiate=function(){return new u(0)},e}(a),h=function(t){function e(t,n){this.label=t,this.units=null!=n?n:null,this.cmp=-4}return n(e,t),e.prototype.copy=function(){return new e(this.label,this.units)},e.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},e.prototype.equals=function(t,n){var i;return null==n&&(n=null),t instanceof e?null!=n?(i=this.label,r.call(n.get(t.label),i)>=0):t.label===this.label:!1},e.prototype.replaceVariables=function(t){var n;return n=this.copy(),this.label in t&&(n.label=t[this.label]),n},e.prototype.getAllVariables=function(){return[this.label]},e.prototype.sub=function(t){var n;return this.label in t?(n=t[this.label],null!=n.copy?n.copy():new u(n)):this.copy()},e.prototype.substituteExpression=function(t,n,e,i){var o,l,u,s;return null==e&&(e=null),null==i&&(i=!1),null==e&&(e={get:function(t){return[t]}}),u=e.get(n),l=i?t.solve(n):[t],this.label===n||(s=this.label,r.call(u,s)>=0)?function(){var t,n,e;for(e=[],t=0,n=l.length;n>t;t++)o=l[t],e.push(o.copy());return e}():[this.copy()]},e.prototype.getUncertainty=function(){return new p(this.label)},e.prototype.getVariableUnits=function(t,n){var e;if(null!=n){if(e=this.label,r.call(n.get(t),e)>=0)return this.units}else if(this.label===t)return this.units;return null},e.prototype.setVariableUnits=function(t,n,e){var i;if(null!=n){if(i=this.label,r.call(n.get(t),i)>=0)return this.units=e}else if(this.label===t)return this.units=e},e.prototype.simplify=function(){return this.copy()},e.prototype.expand=function(){return this.copy()},e.prototype.expandAndSimplify=function(){return this.copy()},e.prototype.toDrawingNode=function(){var t;return t=o.Variable,new t(this.label)},e.prototype.differentiate=function(t){return t===this.label?new u(1):new u(0)},e}(a),p=function(t){function e(t){this.label=t,this.cmp=-4.5}return n(e,t),e.prototype.copy=function(){return new e(this.label)},e.prototype.compareSameType=function(t){return this.label<t.label?-1:this.label===t.label?0:1},e.prototype.equals=function(t,n){var i;return null==n&&(n=null),t instanceof e?null!=n?(i=this.label,r.call(n.get(t.label),i)>=0):t.label===this.label:!1},e.prototype.replaceVariables=function(t){var n;return n=this.copy(),this.label in t&&(n.label=t[this.label]),n},e.prototype.getAllVariables=function(){return[this.label]},e.prototype.sub=function(t,n,e,r){var i;return null==e&&(e=null),null==r&&(r=!1),this.label in n&&null!=n[this.label]?(i=n[this.label],null!=i.copy?i.copy():new u(i)):r?new u("0"):this.copy()},e.prototype.substituteExpression=function(t,n,e,r){throw null==e&&(e=null),null==r&&(r=!1),new Error("Can't sub uncertainties")},e.prototype.getUncertainty=function(){throw new Error("Can't take uncertainty of an uncertainty")},e.prototype.getVariableUnits=function(){throw new Error("Can't do that with uncertainties")},e.prototype.setVariableUnits=function(){throw new Error("Can't do that with uncertainties")},e.prototype.simplify=function(){return this.copy()},e.prototype.expand=function(){return this.copy()},e.prototype.expandAndSimplify=function(){return this.copy()},e.prototype.toDrawingNode=function(){var t;return t=o.Uncertainty,new t(this.label)},e.prototype.differentiate=function(){throw new Error("Can't differentiate uncertainties!")},e}(a),{Terminal:a,Variable:h,Constant:u,SymbolicConstant:s,Uncertainty:p}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};e("AlgebraError",[],function(){var t;return t=function(t){function e(t,n,r){null==r&&(r=null),e.__super__.constructor.call(this,"Unsolvable: "+t+" for "+n+(r?";"+r:""))}return n(e,t),e}(Error)})}.call(this),function(){var t=[].slice;e("parseArgs",["nodes","parse","terminals"],function(n,e,r){var i;return i=function(){var i,o,l,u,s;for(o=1<=arguments.length?t.call(arguments,0):[],l=[],u=0,s=o.length;s>u;u++)if(i=o[u],"string"==typeof i||i instanceof String)l.push(e.stringToTerminal(i));else if("number"==typeof i||i instanceof Number)l.push(new r.Constant(i));else{if(!(i instanceof r.Terminal||i instanceof n.BasicNode||null!=i.isTerminal))throw new Error("Invalid argument "+i+", ("+typeof i+"), ("+i.toString()+")");l.push(i)}return l}})}.call(this),function(){e("compare",[],function(){var t;return t=function(t,n){return null!=t.cmp&&null!=n.cmp?t.cmp===n.cmp?t.compareSameType(n):(t.cmp-n.cmp)/Math.abs(t.cmp-n.cmp):0}})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].slice,i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators/Add",["nodes","terminals","generateInfo","AlgebraError","parseArgs","require","compare","prettyRender"],function(t,e,o,l,u,s,a,p){var h,c;return c=function(t){var n,e,r,i,o,l,u,s,a;if(1===t.length)return function(){var e,r,i,o;for(i=t[0],o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(n);return o}();for(r=[],s=t[0],i=0,l=s.length;l>i;i++)for(n=s[i],a=c(t.slice(1)),o=0,u=a.length;u>o;o++)e=a[o],r.push([n].concat(e));return r},h=function(t){function o(){var t;if(t=1<=arguments.length?r.call(arguments,0):[],t.length<1)throw new Error("Add nodes must have at least one child.");this.cmp=-1,t=u.apply(null,t),o.__super__.constructor.call(this,"+",t)}return n(o,t),o.prototype.copy=function(){var t,n;return t=function(){var t,e,r,i;for(r=this.children,i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(null!=n.copy?n.copy():n);return i}.call(this),function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,t,function(){})},o.prototype.compareSameType=function(t){var n,e,r,i,o,l,u;for(i=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,u=this.children,r=o=0,l=u.length;l>o;r=++o){if(e=u[r],null==t.children[r])return 1;if(n=a(this.children[r],t.children[r]),0!==n)return n}return i},o.prototype.getVariableUnits=function(t,n){var r,o,l,u,s,a,p;for(l=null!=n?n.get(t):[t],a=this.children,u=0,s=a.length;s>u;u++){if(r=a[u],r instanceof e.Variable&&(p=r.label,i.call(l,p)>=0))return r.units;if(o=r.getVariableUnits(t,n),null!=o)return o}return null},o.prototype.setVariableUnits=function(t,n,e){var r,i,o,l,u,s;for(i=null!=n?n.get(t):{get:function(t){return[t]}},u=this.children,s=[],o=0,l=u.length;l>o;o++)r=u[o],s.push(r.setVariableUnits(t,n,e));return s},o.prototype.expand=function(){var t,n,e,r,i,l,u,s,a,p;for(r=[],a=this.children,i=0,u=a.length;u>i;i++)if(e=a[i],null!=e.expand?e=e.expand():null!=e.copy&&(e=e.copy()),e instanceof o)for(p=e.children,l=0,s=p.length;s>l;l++)n=p[l],r.push(n);else r.push(e);return t=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,r,function(){}),t.sort(),t},o.prototype.sort=function(){var t,n,e,r;for(r=this.children,n=0,e=r.length;e>n;n++)t=r[n],"function"==typeof t.sort&&t.sort();return this.children.sort(a)},o.prototype.equals=function(t,n){var e,r,i,l,u;if(!(t instanceof o))return!1;if(t.children.length!==this.children.length)return!1;for(u=this.children,r=i=0,l=u.length;l>i;r=++i)if(e=u[r],null!=e.equals){if(!e.equals(t.children[r],n))return!1}else if(e!==t.children[r])return!1;return!0},o.prototype.simplify=function(t){var n,r,i,l,u,a,p,h,c,f,d,y,g,w,b,m,v,x,S,M,V,A,T,C,k,L,_,E,q,N,j;for(n=s("operators/Mul"),null==t&&(t={get:function(t){return[t]}}),w=[],q=this.children,v=0,V=q.length;V>v;v++)i=q[v],null!=i.simplify?i=i.simplify(t):null!=i.copy&&(i=i.copy()),w.push(i);for(f=[],l=null,p=0;p<w.length;){if(g=w[p],g instanceof o){for(w.splice(p,1)[0],N=g.children,x=0,A=N.length;A>x;x++)r=N[x],w.push(r);p-=1}else if(g instanceof e.Constant)l=null!=l?l.add(g):g.copy();else if(g instanceof n){for(u=null,b=null,j=g.children,S=0,T=j.length;T>S;S++)i=j[S],i instanceof e.Constant?u=null!=u?u.multiply(i):i.copy():null!=b?b.children.push(i):b=new n(i);if(1===b.children.length&&(b=b.children[0]),null!=u&&null==b)l=null!=l?l.add(u):u.copy();else{for(null==u&&(u=new e.Constant("1")),a=!1,h=M=0,C=f.length;C>M;h=++M)c=f[h],null!=c[0].equals?c[0].equals(b,t)&&(f[h][1]=new o(c[1],u),f[h][1]=f[h][1].simplify(t),a=!0):c[0]===b&&(f[h][1]=new o(c[1],u),f[h][1]=f[h][1].simplify(t),a=!0);a||f.push([b,u])}}else{for(a=!1,h=_=0,k=f.length;k>_;h=++_)c=f[h],null!=c[0].equals?c[0].equals(g,t)&&(f[h][1]=new o(c[1],new e.Constant("1")),f[h][1]=f[h][1].simplify(t),a=!0):c[0]===g&&(f[h][1]=new o(c[1],new e.Constant("1")),f[h][1]=f[h][1].simplify(t),a=!0);a||f.push([g,new e.Constant("1")])}p+=1}for(d=null,E=0,L=f.length;L>E;E++)c=f[E],null!=c[0].children&&1===c[0].children.length&&(c[0]=c[0].children[0]),1!==("function"==typeof(m=c[1]).evaluate?m.evaluate():void 0)?(y=new n(c[0],c[1]),y=y.simplify(t)):y=c[0],null!=d?d.children.push(y):d=new o(y);return null==d?l:(null!=l&&0!==l.evaluate()&&d.children.push(l),d.sort(),1!==d.children.length?d:d.children[0])},o.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},o.prototype.solve=function(t,n){var r,u,a,p,h,c,f,d,y,g,w,b,m,v,x,S,M,V,A,T,C,k,L,_,E,q,N,j,O,U,P,D,X,I,B,F,R,z,$,W,Z,H,G,Q,J,K,Y,tn,nn,en,rn,on,ln,un,sn,an,pn,hn,cn,fn,dn,yn,gn,wn;for(null==n&&(n=null),r=s("operators/Mul"),u=s("operators/Pow"),b=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),F=[],R=[],Z=null,H=0,K=n.length;K>H;H++)if(w=n[H],z=this.getVariableUnits(w),null!=z){Z=z;break}if(b instanceof e.Terminal){if(b instanceof e.Variable&&(b.label===t||(un=b.label,i.call(n.get(t),un)>=0)))return[new e.Constant("0")];throw new l(b.toString(),t)}if(!(b instanceof o))return b.solve(t,n);for(sn=b.children,G=0,Y=sn.length;Y>G;G++)if(B=sn[G],null!=B.copy&&(B=B.copy()),B instanceof u)B.children.left instanceof e.Variable&&(B.children.left.label===t||(pn=B.children.left.label,i.call(n.get(t),pn)>=0))?F.push(B):R.push(B);else if(B instanceof r){for(c=!1,hn=B.children,Q=0,tn=hn.length;tn>Q;Q++){if(X=hn[Q],X instanceof e.Variable&&(X.label===t||(cn=X.label,i.call(n.get(t),cn)>=0))){F.push(B),c=!0;break}if(X instanceof u&&X.children.left instanceof e.Variable&&(X.children.left.label===t||(fn=X.children.left.label,i.call(n.get(t),fn)>=0))){F.push(B),c=!0;break}}c||R.push(B)}else B instanceof e.Variable&&(B.label===t||(dn=B.label,i.call(n.get(t),dn)>=0))?F.push(B):R.push(B);if(0===F.length)throw new l(b.toString(),t);for(m=[],x=[],T=[],k=[],J=0,nn=F.length;nn>J;J++)if(B=F[J],B instanceof e.Variable)m.push(new e.Constant("1"));else if(B instanceof u){if(!(B.children.right instanceof e.Constant))throw new l(b.toString(),t);if(U=B.children.right.evaluate(),!(B.children.left instanceof e.Variable&&(B.children.left.label===t||(yn=B.children.left.label,i.call(n.get(t),yn)>=0))))throw new l(b.toString(),t," (this shouldn't happen)");if(1===U)m.push(new e.Constant("1"));else if(2===U)x.push(new e.Constant("1"));else if(-1===U)T.push(new e.Constant("1"));else{if(-2!==U)throw new l(b.toString(),t," (not supported)");k.push(new e.Constant("1"))}}else if(B instanceof r){for(I=[],P=!1,V=!1,A=!1,gn=B.children,on=0,en=gn.length;en>on;on++)if(X=gn[on],X instanceof e.Variable&&(X.label===t||(wn=X.label,i.call(n.get(t),wn)>=0)));else if(X instanceof u){if(!(X.children.right instanceof e.Constant))throw new l(b.toString(),t);if(U=X.children.right.evaluate(),X.children.left instanceof e.Variable&&(X.children.left.label===t||(an=X.children.left.label,i.call(n.get(t),an)>=0)))if(1===U);else if(2===U)P=!0;else if(-1===U)V=!0;else{if(-2!==U)throw new l(b.toString(),t," (not supported)");A=!0}else I.push(X)}else I.push(X);M=I.length>0?function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(r,I,function(){}):new e.Constant("1"),P?x.push(M):V?T.push(M):A?k.push(M):m.push(M)}for(_=[],ln=0,rn=R.length;rn>ln;ln++)B=R[ln],N=new r("-1",null!=B.copy?B.copy():B),N=N.simplify(n),_.push(N);if(0!==_.length&&(E=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,_,function(){})),0!==R.length&&(O=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,R,function(){})),0!==m.length&&(v=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,m,function(){})),0!==x.length&&(S=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,x,function(){})),0!==T.length&&(C=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,T,function(){})),0!==k.length&&(L=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,k,function(){})),0===_.length&&(E=new e.Constant("0")),0===x.length){if(0===m.length){if(0===T.length){if(0===k.length)throw new l(b.toString(),t);return f=new r(new u(L,"1/2"),new u(E,"-1/2")),p=new r(-1,f.copy()),p=p.expandAndSimplify(n),h=f.expandAndSimplify(n),("function"==typeof p.equals?p.equals(h):void 0)?[p]:[p,h]}return 0===k.length?(f=new r(C,new u(E,"-1")),[f.expandAndSimplify(n)]):(q=new o(new r(O,new u(new e.Variable(t,Z),2)),new r(C,new e.Variable(t,Z)),L),q.solve(t,n))}if(0===T.length){if(0===k.length)return f=new r(E,new u(v,"-1")),[f.expandAndSimplify(n)];throw new l(b.toString(),t," (not supported)")}throw new l(b.toString(),t," (not supported)")}if(0===m.length){if(0===T.length){if(0===k.length)return f=new u(new r(E,new u(S,"-1")),"1/2"),p=new r("-1",f.copy()),p=p.expandAndSimplify(n),h=f.expandAndSimplify(n),("function"==typeof p.equals?p.equals(h):void 0)?[p]:[p,h];throw new l(b.toString(),t," (not supported)")}throw new l(b.toString(),t," (not supported)")}if(T.length>0||k.length>0)throw new l(b.toString(),t," (not supported)");return null!=O?(a=S,d=v,y=O,g=new o(new u(d,"2"),new r("-4",a,y)),D=new u(g,"1/2"),$=new r(new o(new r("-1",d),D),new u(new r("2",a),"-1")),W=new r("-1",new o(d,D),new u(new r("2",a),"-1")),$=$.expandAndSimplify(n),W=W.expandAndSimplify(n),null!=$.equals&&$.equals(W)?[$]:[$,W]):(j=new u(S,"-1"),N=new r("-1",v,j),N=N.simplify(n),[0,N])
},o.prototype.getAllVariables=function(){var t,n,r,i,o,l,u,s,a,p;for(o={},p=this.children,l=0,s=p.length;s>l;l++)if(t=p[l],t instanceof e.Variable)o[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),u=0,a=n.length;a>u;u++)i=n[u],o[i]=!0;r=[];for(i in o)r.push(i);return r},o.prototype.replaceVariables=function(t){var n,r,i,l,u,s;for(r=[],s=this.children,i=l=0,u=s.length;u>l;i=++l)n=s[i],n instanceof e.Variable&&n.label in t?(r.push(n.copy()),r[i].label=t[n.label]):null!=n.replaceVariables?r.push(n.replaceVariables(t)):r.push(n.copy());return function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,r,function(){})},o.prototype.sub=function(t,n,r,i,l){var u,s,a,p,h,c,f,d,y,g,w,b;null==r&&(r=null),null==i&&(i=!1),null==l&&(l=!1);for(c in t)null==t[c].copy&&(t[c]=new e.Constant(t[c]));for(null==r&&(r={get:function(t){return[t]}}),s=[],b=this.children,d=0,g=b.length;g>d;d++)if(u=b[d],u instanceof e.Variable){for(f=r.get(u.label),h=!1,y=0,w=f.length;w>y;y++)if(a=f[y],a in t){s.push(t[a].copy()),h=!0;break}h||s.push(u.copy())}else null!=u.sub?s.push(u.sub(t,n,r,i,l)):s.push(u.copy());return p=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,s,function(){}),p=p.expandAndSimplify(r)},o.prototype.substituteExpression=function(t,n,r,l){var u,s,a,p,h,f,d,y,g,w,b,m,v,x,S,M,V;for(null==r&&(r=null),null==l&&(l=!1),y=l?t.solve(n,r):[t],null==r&&(r={get:function(t){return[t]}}),g=r.get(n),d=[],w=0,v=y.length;v>w;w++){for(h=y[w],p=[],M=this.children,b=0,x=M.length;x>b;b++)u=M[b],u instanceof e.Variable&&(u.label===n||(V=u.label,i.call(g,V)>=0))?p.push([h.copy()]):null!=u.substituteExpression?p.push(u.substituteExpression(h,n,r)):p.push([u.copy()]);a=c(p)}for(m=0,S=a.length;S>m;m++)s=a[m],f=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,s,function(){}),d.push(f.expandAndSimplify(r));return d},o.prototype.toDrawingNode=function(){var t;return t=p.Add,t.makeWithBrackets.apply(t,this.children.map(function(t){return t.toDrawingNode()}))},o.prototype.differentiate=function(t){var n,e;return e=this.children.map(function(n){return n.differentiate(t)}),n=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,e,function(){}),n.expandAndSimplify()},o}(t.RoseNode)})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].slice,i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators/Mul",["nodes","terminals","generateInfo","AlgebraError","parseArgs","require","compare","prettyRender"],function(t,e,o,l,u,s,a,p){var h,c;return c=function(t){var n,e,r,i,o,l,u,s,a;if(1===t.length)return function(){var e,r,i,o;for(i=t[0],o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(n);return o}();for(r=[],s=t[0],i=0,l=s.length;l>i;i++)for(n=s[i],a=c(t.slice(1)),o=0,u=a.length;u>o;o++)e=a[o],r.push([n].concat(e));return r},h=function(t){function o(){var t;if(t=1<=arguments.length?r.call(arguments,0):[],t.length<1)throw new Error("Mul nodes must have at least one child.");this.cmp=-2,t=u.apply(null,t),o.__super__.constructor.call(this,"*",t)}return n(o,t),o.prototype.copy=function(){var t,n;return t=function(){var t,e,r,i;for(r=this.children,i=[],t=0,e=r.length;e>t;t++)n=r[t],i.push(null!=n.copy?n.copy():n);return i}.call(this),function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,t,function(){})},o.prototype.simplifyConstants=function(){var t,n,r,i,l,u;for(n=new e.Constant("1"),r=null,u=this.children,i=0,l=u.length;l>i;i++)t=u[i],t instanceof e.Constant?n=n.multiply(t):null!=r?r.children.push(t):r=new o(t);return null==r?n:1===n.evaluate()?r:new o(n,r)},o.prototype.compareSameType=function(t){var n,e,r,i,o,l,u;for(i=this.children.length===t.children.length?0:this.children.length<t.children.length?-1:1,u=this.children,r=o=0,l=u.length;l>o;r=++o){if(e=u[r],null==t.children[r])return 1;if(n=a(this.children[r],t.children[r]),0!==n)return n}return i},o.prototype.getVariableUnits=function(t,n){var r,o,l,u,s,a,p;for(l=null!=n?n.get(t):[t],a=this.children,u=0,s=a.length;s>u;u++){if(r=a[u],r instanceof e.Variable&&(p=r.label,i.call(l,p)>=0))return r.units;if(o=r.getVariableUnits(t,n),null!=o)return o}return null},o.prototype.setVariableUnits=function(t,n,e){var r,i,o,l,u,s;for(i=null!=n?n.get(t):{get:function(t){return[t]}},u=this.children,s=[],o=0,l=u.length;l>o;o++)r=u[o],s.push(r.setVariableUnits(t,n,e));return s},o.expandMulAdd=function(t,n){var e,r,i,l,u,a,p,h,c,f,d,y;for(e=s("operators/Add"),a=[],d=n.children,p=0,c=d.length;c>p;p++){if(i=d[p],null!=i.copy&&(i=i.copy()),i instanceof o)for(u=t.copy(),y=i.children,h=0,f=y.length;f>h;h++)r=y[h],u.children.push(r);else i instanceof e?u=o.expandMulAdd(t,i):1===t.children.length?(u=t.copy(),u.children.push(i.copy())):u=new o(t.copy(),i.copy());a.push(u)}return l=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(e,a,function(){}),l=l.expand()},o.prototype.equals=function(t,n){var e,r,i,l,u;if(!(t instanceof o))return!1;if(t.children.length!==this.children.length)return!1;for(u=this.children,r=i=0,l=u.length;l>i;r=++i)if(e=u[r],null!=e.equals){if(!e.equals(t.children[r],n))return!1}else if(e!==t.children[r])return!1;return!0},o.prototype.expand=function(){var t,n,e,r,i,l,u,a,p,h,c,f,d,y,g;for(t=s("operators/Add"),i=[],d=this.children,u=0,h=d.length;h>u;u++)n=d[u],null!=n.expand?n=n.expand():null!=n.copy&&(n=n.copy()),i.push(n);for(;i.length>1;)if(i[0]instanceof o)if(i[1]instanceof t)i[0]=o.expandMulAdd(i[0],i.splice(1,1)[0]);else if(i[1]instanceof o)for(y=i.splice(1,1)[0].children,a=0,c=y.length;c>a;a++)n=y[a],i[0].children.push(n);else i[0].children.push(i.splice(1,1)[0]);else if(i[0]instanceof t)if(i[1]instanceof t){for(r=[],g=i[0].children,p=0,f=g.length;f>p;p++)n=g[p],e=new o(n,i[1]),e=e.expand(),r.push(e);i.splice(1,1),i[0]=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(t,r,function(){}),i[0]=i[0].expand()}else i[0]=i[1]instanceof o?o.expandMulAdd(i.splice(1,1)[0],i[0]):new o(i[0],i.splice(1,1)[0]);else i[0]=new o(i[0]);return"function"==typeof(l=i[0]).sort&&l.sort(),i[0]},o.prototype.simplify=function(t){var n,r,i,l,u,a,p,h,c,f,d,y,g,w,b,m,v,x,S,M,V,A,T,C,k,L,_,E,q,N,j,O,U,P,D,X,I;for(n=s("operators/Add"),r=s("operators/Pow"),null==t&&(t={get:function(t){return[t]}}),v=[],j=this.children,S=0,T=j.length;T>S;S++)u=j[S],null!=u.simplify?u=u.simplify(t):null!=u.copy&&(u=u.copy()),v.push(u);for(d=[],a=null,h=0;h<v.length;){if(m=v[h],m instanceof o){for(u=v.splice(h,1)[0],O=u.children,M=0,C=O.length;C>M;M++)l=O[M],v.push(l);h-=1}else if(m instanceof e.Constant)a=null!=a?a.multiply(m):m.copy();else if(m instanceof r){for(i=m.children.left,b=m.children.right,p=!1,c=V=0,k=d.length;k>V;c=++V)f=d[c],null!=f[0].equals?f[0].equals(i,t)&&(d[c][1]=new n(f[1],b),d[c][1]=d[c][1].simplify(t),1===(null!=(U=d[c][1].children)?U.length:void 0)&&(d[c][1]=d[c][1].children[0]),p=!0):f[0]===i&&(d[c][1]=new n(f[1],b),d[c][1]=d[c][1].simplify(t),1===(null!=(P=d[c][1].children)?P.length:void 0)&&(d[c][1]=d[c][1].children[0]),p=!0);p||d.push([i,b])}else{for(p=!1,c=A=0,L=d.length;L>A;c=++A)f=d[c],null!=f[0].equals?f[0].equals(m,t)&&(d[c][1]=new n(f[1],new e.Constant("1")),d[c][1]=d[c][1].simplify(t),1===(null!=(D=d[c][1].children)?D.length:void 0)&&(d[c][1]=d[c][1].children[0]),p=!0):f[0]===m&&(d[c][1]=new n(f[1],new e.Constant("1")),d[c][1]=d[c][1].simplify(t),1===(null!=(X=d[c][1].children)?X.length:void 0)&&(d[c][1]=d[c][1].children[0]),p=!0);p||d.push([m,new e.Constant("1")])}h+=1}if(0===(null!=a?"function"==typeof a.evaluate?a.evaluate():void 0:void 0))return new e.Constant("0");for(y=null,q=0,_=d.length;_>q;q++)f=d[q],1!==("function"==typeof(x=f[1]).evaluate?x.evaluate():void 0)?(g=new r(f[0],f[1]),g=g.simplify(t)):g=f[0],null!=y?y.children.push(g):y=new o(g);if(null==y)return a;for(null!=a&&1!==a.evaluate()&&y.children.push(a),y.sort(),w=!0,I=y.children,N=0,E=I.length;E>N;N++)if(u=I[N],!(u instanceof e.Constant)){w=!1;break}return w?y.simplifyConstants():1!==y.children.length?y:y.children[0]},o.prototype.sort=function(){var t,n,e,r;for(r=this.children,n=0,e=r.length;e>n;n++)t=r[n],"function"==typeof t.sort&&t.sort();return this.children.sort(a)},o.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},o.prototype.solve=function(t,n){var r,u,a,p,h,c,f,d,y;if(null==n&&(n=null),r=s("operators/Pow"),p=this.expandAndSimplify(n),null==n&&(n={get:function(t){return[t]}}),p instanceof e.Terminal){if(p instanceof e.Variable&&(p.label===t||(f=p.label,i.call(n.get(t),f)>=0)))return[new e.Constant("0")];throw new l(p.toString(),t)}if(!(p instanceof o))return p.solve(t,n);for(d=p.children,h=0,c=d.length;c>h;h++){if(u=d[h],u instanceof e.Variable&&(u.label===t||(y=u.label,i.call(n.get(t),y)>=0)))return[new e.Constant("0")];if(u instanceof r)try{return u.solve(t,n)}catch(g){if(a=g,a instanceof l)continue;throw a}}throw new l(p.toString(),t)},o.prototype.getAllVariables=function(){var t,n,r,i,o,l,u,s,a,p;for(o={},p=this.children,l=0,s=p.length;s>l;l++)if(t=p[l],t instanceof e.Variable)o[t.label]=!0;else if(null!=t.getAllVariables)for(n=t.getAllVariables(),u=0,a=n.length;a>u;u++)i=n[u],o[i]=!0;r=[];for(i in o)r.push(i);return r},o.prototype.replaceVariables=function(t){var n,r,i,l,u,s;for(r=[],s=this.children,i=l=0,u=s.length;u>l;i=++l)n=s[i],n instanceof e.Variable&&n.label in t?(r.push(n.copy()),r[i].label=t[n.label]):null!=n.replaceVariables?r.push(n.replaceVariables(t)):r.push(n.copy());return function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,r,function(){})},o.prototype.sub=function(t,n,r,i,l){var u,s,a,p,h,c,f,d,y,g,w,b;null==r&&(r=null),null==i&&(i=!1),null==l&&(l=!1);for(c in t)null==t[c].copy&&(t[c]=new e.Constant(t[c]));for(null==r&&(r={get:function(t){return[t]}}),s=[],b=this.children,d=0,g=b.length;g>d;d++)if(u=b[d],u instanceof e.Variable){for(f=r.get(u.label),h=!1,y=0,w=f.length;w>y;y++)if(a=f[y],a in t){s.push(t[a].copy()),h=!0;break}h||s.push(u.copy())}else null!=u.sub?s.push(u.sub(t,n,r,i,l)):s.push(u.copy());return p=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,s,function(){}),p=p.expandAndSimplify(r)},o.prototype.substituteExpression=function(t,n,r,l){var u,s,a,p,h,f,d,y,g,w,b,m,v,x,S,M,V;for(null==r&&(r=null),null==l&&(l=!1),y=l?t.solve(n,r):[t],null==r&&(r={get:function(t){return[t]}}),g=r.get(n),d=[],w=0,v=y.length;v>w;w++){for(h=y[w],p=[],M=this.children,b=0,x=M.length;x>b;b++)u=M[b],u instanceof e.Variable&&(u.label===n||(V=u.label,i.call(g,V)>=0))?p.push([h.copy()]):null!=u.substituteExpression?p.push(u.substituteExpression(h,n,r)):p.push([u.copy()]);for(console.log("childrenExpressions",p),a=c(p),console.log("childrenArray",a),m=0,S=a.length;S>m;m++)s=a[m],f=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,s,function(){}),d.push(f.expandAndSimplify(r))}return console.log(d),d},o.prototype.toDrawingNode=function(){var t,n,r,i,o,l,u,a,h,c,f;for(t=s("operators/Pow"),e=s("terminals"),l=[],n=[],h=this.children,u=0,a=h.length;a>u;u++)r=h[u],r instanceof t?(o=r.children.right,o instanceof e.Constant?(o.denominator<0&&(o.denominator*=-1,o.numerator*=-1),o.numerator<0?n.push(new t(r.children.left,new e.Constant(o.numerator,-o.denominator)).toDrawingNode()):l.push(r.toDrawingNode())):l.push(r.toDrawingNode())):r instanceof e.Constant?(1!==r.numerator&&l.unshift(new p.Number(r.numerator)),1!==r.denominator&&n.unshift(new p.Number(r.denominator))):l.push(r.toDrawingNode());return 1===n.length?i=n[0]:n.length>1&&(i=(c=p.Mul).makeWithBrackets.apply(c,n)),1===l.length?l=l[0]:l.length>1&&(l=(f=p.Mul).makeWithBrackets.apply(f,l)),0===n.length?l:0===l.length?new p.Fraction(new p.Number(1),i):new p.Fraction(l,i)},o.prototype.differentiate=function(t){var n,e,r;if(n=s("operators/Add"),0===this.children.length)throw new Error("I'm pretty sure you need children in your Mul node");return 1===this.children.length?this.children[0].differentiate(t).expandAndSimplify():(e=this.children[0],r=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(o,this.children.slice(1),function(){}),new n(new o(e,r.differentiate(t)),new o(r,e.differentiate(t))).expandAndSimplify())},o}(t.RoseNode)})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function r(){this.constructor=n}for(var i in e)t.call(e,i)&&(n[i]=e[i]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n},r=[].slice,i=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};e("operators/Pow",["nodes","terminals","generateInfo","AlgebraError","parseArgs","require","compare","prettyRender"],function(t,e,o,l,u,s,a,p){var h;return h=function(t){function o(){var t,n,e,i;if(n=arguments[0],e=arguments[1],t=3<=arguments.length?r.call(arguments,2):[],null==n||null==e)throw new Error("Pow nodes must have two children.");if(t.length>0)throw new Error("Pow nodes must have two children.");this.cmp=-3,i=u(n,e),n=i[0],e=i[1],o.__super__.constructor.call(this,"**",n,e)}return n(o,t),o.prototype.copy=function(){return new o(null!=this.children.left.copy?this.children.left.copy():this.children.left,null!=this.children.right.copy?this.children.right.copy():this.children.right)},o.prototype.sort=function(){var t,n;return"function"==typeof(t=this.children.left).sort&&t.sort(),"function"==typeof(n=this.children.right).sort?n.sort():void 0},o.prototype.equals=function(t,n){if(!(t instanceof o))return!1;if(null!=this.children.left.equals){if(!this.children.left.equals(t.children.left,n))return!1}else if(this.children.left!==t.children.left)return!1;if(null!=this.children.right.equals){if(!this.children.right.equals(t.children.right,n))return!1}else if(this.children.right!==t.children.right)return!1;return!0},o.prototype.compareSameType=function(t){var n;return n=a(this.children.left,t.children.left),0!==n?n:a(this.children.right,t.children.right)},o.prototype.getVariableUnits=function(t,n){var r,o,l,u,s;return l=null!=n?n.get(t):{get:function(t){return[t]}},this.children.left instanceof e.Variable&&(u=this.children.left.label,i.call(l,u)>=0)?this.children.left.units:(r=this.children.left.getVariableUnits(t,n),null!=r?r:this.children.right instanceof e.Variable&&(s=this.children.right.label,i.call(l,s)>=0)?this.children.right.units:(o=this.children.right.getVariableUnits(t,n),null!=o?o:null))},o.prototype.setVariableUnits=function(t,n,e){var r;return r=null!=n?n.get(t):{get:function(t){return[t]}},this.children.left.setVariableUnits(t,n,e),this.children.right.setVariableUnits(t,n,e)},o.prototype.expand=function(){var t,n,r,i,l,u,a,p,h,c,f,d,y,g,w;if(n=s("operators/Mul"),t=s("operators/Add"),a=null!=this.children.left.expand?this.children.left.expand():null!=this.children.left.copy?this.children.left.copy():this.children.left,c=null!=this.children.right.expand?this.children.right.expand():null!=this.children.right.copy?this.children.right.copy():this.children.right,null!=a.children){if(a instanceof o)a.children.right=new n(a.children.right,c),a.expand();else if(a instanceof n)for(g=a.children,u=f=0,y=g.length;y>f;u=++f)r=g[u],h=new o(r,c),h=h.expand(),a.children[u]=h;else if(a instanceof t)if(c instanceof e.Constant&&0===c.evaluate()%1&&c.evaluate()>0){for(i=[],l=d=1,w=c.evaluate();w>=1?w>=d:d>=w;l=w>=1?++d:--d)i.push(a);p=function(t,n,e){e.prototype=t.prototype;var r=new e,i=t.apply(r,n);return Object(i)===i?i:r}(n,i,function(){}),p=p.expand(),a=p}else a=new o(a,c);return a}return new o(a,c)},o.prototype.simplify=function(t){var n,r,i,l,u;return n=s("operators/Mul"),null==t&&(t={get:function(t){return[t]}}),r=null!=this.children.left.simplify?this.children.left.simplify(t):null!=this.children.left.copy?this.children.left.copy():this.children.left,u=null!=this.children.right.simplify?this.children.right.simplify(t):null!=this.children.right.copy?this.children.right.copy():this.children.right,1===("function"==typeof u.evaluate?u.evaluate():void 0)?r:1===("function"==typeof r.evaluate?r.evaluate():void 0)?r:0===("function"==typeof u.evaluate?u.evaluate():void 0)?new e.Constant("1"):u instanceof e.Constant&&r instanceof e.Constant?new e.Constant(Math.pow(r.evaluate(),u.evaluate())):r instanceof o?(l=new n(r.children.right,u),i=new o(r.children.left,l),i=i.simplify(t)):new o(r,u)},o.prototype.expandAndSimplify=function(t){var n;return n=this.expand(),null!=n.simplify?n.simplify(t):n},o.prototype.solve=function(t,n){var r,u,a,p,h,c,f,d,y,g,w;if(r=s("operators/Mul"),null==n&&(n={get:function(t){return[t]}}),a=this.expandAndSimplify(n),a instanceof e.Terminal){if(a instanceof e.Variable&&(a.label===t||(g=a.label,i.call(n.get(t),g)>=0)))return[new e.Constant("0")];throw new l(a.toString(),t)}if(a instanceof o){if(a.children.left instanceof e.Variable){if(a.children.left.label===t||(w=a.children.left.label,i.call(n.get(t),w)>=0))return[new e.Constant("0")];throw new l(a.toString(),t)}if(a.children.left instanceof e.Terminal)throw new l(a.toString(),t);try{f=a.children.left.solve(t,n)}catch(b){throw u=b}if(null!=a.children.right.evaluate&&0===a.children.right.evaluate()%2){for(h=[],d=0,y=f.length;y>d;d++)c=f[d],p=new r(-1,c).simplify(n),null!=p.equals?(p.equals(c)||h.push(p),h.push(c)):(p!==c&&h.push(p),h.push(c));return h}return f}return a.solve(t,n)},o.prototype.sub=function(t,n,r,i,l){var u,s,a,p,h,c,f,d,y,g,w;null==r&&(r=null),null==i&&(i=!1),null==l&&(l=!1);for(c in t)null==t[c].copy&&(t[c]=new e.Constant(t[c]));if(null==r&&(r={get:function(t){return[t]}}),s=null,p=null,this.children.left instanceof e.Variable){for(f=r.get(this.children.left.label),h=!1,d=0,g=f.length;g>d;d++)if(u=f[d],u in t){s=t[u].copy(),h=!0;break}h||(s=this.children.left.copy())}else s=null!=this.children.left.sub?this.children.left.sub(t,n,r,i,l):this.children.left.copy();if(this.children.right instanceof e.Variable){for(f=r.get(this.children.right.label),h=!1,y=0,w=f.length;w>y;y++)if(u=f[y],u in t){p=t[u].copy(),h=!0;break}h||(p=this.children.right.copy())}else p=null!=this.children.right.sub?this.children.right.sub(t,n,r,i,l):this.children.right.copy();return a=new o(s,p),a=a.expandAndSimplify(r)},o.prototype.getAllVariables=function(){var t,n,r,i,o,l,u,s,a;if(o={},this.children.left instanceof e.Variable)o[this.children.left.label]=!0;else if(null!=this.children.left.getAllVariables)for(t=this.children.left.getAllVariables(),l=0,s=t.length;s>l;l++)i=t[l],o[i]=!0;if(this.children.right instanceof e.Variable)o[this.children.right.label]=!0;else if(null!=this.children.right.getAllVariables)for(r=this.children.right.getAllVariables(),u=0,a=r.length;a>u;u++)i=r[u],o[i]=!0;n=[];for(i in o)n.push(i);return n},o.prototype.replaceVariables=function(t){var n,r;return n=this.children.left.copy(),r=this.children.right.copy(),n instanceof e.Variable&&n.label in t?n.label=t[n.label]:null!=n.replaceVariables&&(n=n.replaceVariables(t)),r instanceof e.Variable&&r.label in t?r.label=t[r.label]:null!=r.replaceVariables&&(r=r.replaceVariables(t)),new o(n,r)},o.prototype.substituteExpression=function(t,n,r,l){var u,s,a,p,h,c,f,d,y,g,w,b,m,v,x,S,M;for(null==r&&(r=null),null==l&&(l=!1),d=l?t.solve(n,r):[t],null==r&&(r={get:function(t){return[t]}}),y=r.get(n),c=[],g=0,m=d.length;m>g;g++)for(u=d[g],p=[this.children.left.copy()],f=[this.children.right.copy()],this.children.left instanceof e.Variable&&(this.children.left.label===n||(S=this.children.left.label,i.call(y,S)>=0))?p=[u.copy()]:this.children.left instanceof e.Terminal||(p=this.children.left.substituteExpression(u,n,r)),this.children.right instanceof e.Variable&&(this.children.right.label===n||(M=this.children.right.label,i.call(y,M)>=0))?f=[u.copy()]:this.children.right instanceof e.Terminal||(f=this.children.right.substituteExpression(u,n,r)),w=0,v=p.length;v>w;w++)for(s=p[w],b=0,x=f.length;x>b;b++)a=f[b],h=new o(s,a),h=h.expandAndSimplify(r),c.push(h);return c},o.prototype.toDrawingNode=function(){var t,n,r,i;return i=null!=p?p.Surd:void 0,r=p.Pow,t=p.Fraction,n=p.Number,this.children.right instanceof e.Constant&&1===this.children.right.numerator?1===this.children.right.denominator?this.children.left.toDrawingNode():this.children.right.denominator>0?new i(this.children.left.toDrawingNode(),this.children.right.denominator):new t(new n(1),new i(this.children.left.toDrawingNode(),-this.children.right.denominator)):new r(this.children.left.toDrawingNode(),this.children.right.toDrawingNode())},o.prototype.differentiate=function(t){var n,e,r,l;if(n=s("operators/Add"),r=s("operators/Mul"),e=s("terminals").Constant,i.call(this.children.right.getAllVariables,t)>=0)throw new Error("I can't differentiate with a variable on the top of a power");return 0===("function"==typeof(l=this.children.right).evaluate?l.evaluate():void 0)?new e(0):new r(new o(this.children.left,new n(this.children.right,new e(-1))),this.children.left.differentiate(t),this.children.right).expandAndSimplify()},o}(t.BinaryNode)})}.call(this),function(){e("operators",["operators/Add","operators/Mul","operators/Pow"],function(t,n,e){return{Add:t,Mul:n,Pow:e}})}.call(this),function(){e("Expression",["parse","nodes"],function(t){var n;return n=function(){function n(n){if(n instanceof String||"string"==typeof n)this.expr=t.stringToExpression(n);else{if(null==n.copy)throw console.log("Received argument: ",n),new Error("Unknown argument: `"+n+"'.");this.expr=n.copy()}}return n.prototype.toString=function(){return this.expr.toString()},n.prototype.toMathML=function(){return this.expr.toMathML()},n.prototype.toLaTeX=function(){return this.expr.toLaTeX()},n.prototype.solve=function(t){var e,r,i,o,l;for(o=this.expr.solve(t),l=[],r=0,i=o.length;i>r;r++)e=o[r],l.push(new n(e));return l},n.prototype.sub=function(t){var e,r;r={};for(e in t)r[e]=t[e]instanceof n?t[e].expr:t[e];return new n(this.expr.sub(r,null,null).simplify())},n.prototype.copy=function(){return new n(this.expr.copy())},n.prototype.simplify=function(){return new n(this.expr.simplify())},n}()})}.call(this),function(){var t=[].slice;n.config({baseUrl:"./"}),e("coffeequate",["operators","Expression","parse"],function(n,e,r){return function(){var i,o,l,u,s;return i=1<=arguments.length?t.call(arguments,0):[],1===i.length&&("string"==typeof i[0]||i[0]instanceof String)?/\=/.test(i[0])?(s=i[0].split("="),o=s[0],l=s[1],u=new n.Add(r.stringToExpression(l),new n.Mul(r.stringToExpression(o),"-1")),new e(u)):new e(i[0]):void 0}})}.call(this),n(["coffeequate"]),n("coffeequate")});